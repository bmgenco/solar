row <- forcing_ranking[i, ]
cost_formatted <- ifelse(is.finite(row$cost_per_forcing_unit),
paste0("$", round(row$cost_per_forcing_unit, 0)),
"N/A")
cat("  ", i, ". ", row$scenario_name, ": ", cost_formatted, "/forcing unit\n", sep="")
cat("     Cost: $", format(row$upfront_cost, big.mark=","),
", 20-yr forcing avoided: ", round(row$forcing_avoided, 1), " units\n", sep="")
}
# Create comparison visualization
comparison_data <- dual_effectiveness %>%
mutate(
scenario_label = case_when(
scenario == "heat_pump_water_heater" ~ "Heat Pump WH",
scenario == "solar_battery" ~ "Solar+Battery",
scenario == "full_electrification" ~ "Full Electric",
TRUE ~ str_replace_all(scenario, "_", " ")
)
)
p_dual_comparison <- ggplot(comparison_data, aes(x = cost_per_ton_standard, y = cost_per_forcing_unit)) +
geom_point(aes(size = upfront_cost, color = scenario_label), alpha = 0.7) +
geom_text_repel(aes(label = scenario_label), size = 3, nudge_y = 0.1) +
scale_size_continuous(name = "Upfront Cost ($)", range = c(3, 10),
labels = function(x) paste0("$", format(x/1000, digits=1), "K")) +
scale_color_viridis_d(name = "Scenario") +
scale_x_log10(labels = function(x) paste0("$", x)) +
scale_y_log10(labels = function(x) paste0("$", x)) +
labs(title = "Dual Cost-Effectiveness: Standard vs Tipping Points Perspective",
subtitle = "Lower values = more cost-effective",
x = "Cost per Ton CO2e Avoided ($/ton) - Standard Metric",
y = "Cost per Forcing Unit Avoided ($/unit) - Tipping Points Metric",
caption = "Point size = upfront cost. Lower-left = best on both metrics.") +
theme_minimal() +
theme(legend.position = "right")
print(p_dual_comparison)
# Calculate ranking differences
ranking_comparison <- standard_ranking %>%
select(scenario_name, rank_standard) %>%
left_join(forcing_ranking %>% select(scenario_name, rank_forcing), by = "scenario_name") %>%
mutate(rank_difference = rank_forcing - rank_standard)
cat("\n=== RANKING COMPARISON ===\n")
cat("How tipping points perspective changes cost-effectiveness ranking:\n")
for(i in 1:nrow(ranking_comparison)) {
row <- ranking_comparison[i, ]
if(row$rank_difference == 0) {
cat("  ", row$scenario_name, ": Same ranking (", row$rank_standard, ")\n", sep="")
} else if(row$rank_difference > 0) {
cat("  ", row$scenario_name, ": Drops ", abs(row$rank_difference), " position(s) in tipping points metric\n", sep="")
} else {
cat("  ", row$scenario_name, ": Improves ", abs(row$rank_difference), " position(s) in tipping points metric\n", sep="")
}
}
# DETAILED METHANE vs CO2 ANALYSIS FOR TIPPING POINTS CONSIDERATION
cat("=== METHANE vs CO2 IMPACT ANALYSIS ===\n")
cat("Critical for tipping points: methane provides 84x warming over 20 years but decays rapidly\n\n")
# Calculate gas supply chain breakdown with three leakage scenarios
gas_impact_scenarios <- data.frame(
scenario = c("EPA_Conservative", "Atmospheric_Realistic", "Satellite_High"),
leakage_rate = c(0.025, 0.045, 0.065),
source = c("EPA Natural Gas STAR", "Alvarez Nature 2024", "Chen Nature 2022")
)
cat("NATURAL GAS SUPPLY CHAIN IMPACT (per 100 therms):\n")
for(i in 1:nrow(gas_impact_scenarios)) {
# 20-year GWP (tipping points metric)
gas_20yr <- calculate_complete_gas_emissions(100, gas_impact_scenarios$leakage_rate[i], 20)
# 100-year GWP (traditional metric)
gas_100yr <- calculate_complete_gas_emissions(100, gas_impact_scenarios$leakage_rate[i], 100)
methane_share_20yr <- gas_20yr$fugitive_ch4_co2e_lbs / gas_20yr$total_co2e_lbs * 100
methane_share_100yr <- gas_100yr$fugitive_ch4_co2e_lbs / gas_100yr$total_co2e_lbs * 100
cat("\n", gas_impact_scenarios$scenario[i], " (", gas_impact_scenarios$leakage_rate[i]*100, "% leakage):\n", sep="")
cat("  Source: ", gas_impact_scenarios$source[i], "\n", sep="")
cat("  20-year impact: ", round(gas_20yr$total_co2e_tons, 1), " tons CO2e (methane: ", round(methane_share_20yr, 0), "%)\n", sep="")
cat("  100-year impact: ", round(gas_100yr$total_co2e_tons, 1), " tons CO2e (methane: ", round(methane_share_100yr, 0), "%)\n", sep="")
cat("  Breakdown:\n")
cat("    Direct combustion: ", round(gas_20yr$combustion_co2_lbs/2000, 1), " tons CO2\n", sep="")
cat("    Upstream CO2: ", round(gas_20yr$upstream_co2_lbs/2000, 1), " tons CO2\n", sep="")
cat("    Fugitive methane: ", round(gas_20yr$fugitive_ch4_lbs/2000, 3), " tons CH4 â†’ ",
round(gas_20yr$fugitive_ch4_co2e_lbs/2000, 1), " tons CO2e (20-yr)\n", sep="")
}
# Use realistic scenario for house-specific analysis
house_gas_therms <- house_profile$baseline_consumption$gas_appliance_breakdown$stove_therms +
house_profile$baseline_consumption$gas_appliance_breakdown$water_heater_therms +
house_profile$baseline_consumption$gas_appliance_breakdown$hvac_therms
realistic_gas_impact <- calculate_complete_gas_emissions(house_gas_therms, realistic_methane_rate, 20)
cat("\n=== YOUR HOUSE GAS IMPACT (", house_gas_therms, " therms/year) ===\n", sep="")
cat("Using realistic 4.5% leakage rate (atmospheric studies):\n")
cat("  Annual CO2e impact: ", round(realistic_gas_impact$total_co2e_tons, 1), " tons (20-year GWP)\n", sep="")
cat("  Methane component: ", round(realistic_gas_impact$fugitive_ch4_co2e_lbs/2000, 1), " tons CO2e (",
round(realistic_gas_impact$fugitive_ch4_co2e_lbs/realistic_gas_impact$total_co2e_lbs*100, 0), "%)\n", sep="")
cat("  CO2 component: ", round((realistic_gas_impact$combustion_co2_lbs + realistic_gas_impact$upstream_co2_lbs)/2000, 1),
" tons CO2 (", round((realistic_gas_impact$combustion_co2_lbs + realistic_gas_impact$upstream_co2_lbs)/realistic_gas_impact$total_co2e_lbs*100, 0), "%)\n", sep="")
cat("\nGas appliance breakdown:\n")
for(appliance in c("stove", "water_heater", "hvac")) {
therms <- house_profile$baseline_consumption$gas_appliance_breakdown[[paste0(appliance, "_therms")]]
appliance_impact <- calculate_complete_gas_emissions(therms, realistic_methane_rate, 20)
cat("  ", str_to_title(str_replace(appliance, "_", " ")), " (", therms, " therms): ",
round(appliance_impact$total_co2e_tons, 1), " tons CO2e/year\n", sep="")
}
# Methane decay analysis
cat("\n=== METHANE ATMOSPHERIC BEHAVIOR ===\n")
cat("Methane lifetime: ", emissions_factors_complete$gas_supply_chain$ch4_atmospheric_lifetime, " years (vs CO2: centuries)\n", sep="")
cat("Decay rate: ", round((1-exp(-1/9.5))*100, 1), "% per year\n", sep="")
cat("50% remaining after: ", round(9.5*log(2), 1), " years\n", sep="")
cat("90% gone after: ", round(9.5*log(10), 1), " years\n", sep="")
# Create methane decay visualization
years_decay <- 0:30
ch4_remaining <- exp(-years_decay/9.5)
co2_remaining <- rep(0.99, length(years_decay))^years_decay  # Very slow decay
decay_data <- data.frame(
year = rep(years_decay, 2),
fraction_remaining = c(ch4_remaining, co2_remaining),
gas_type = rep(c("Methane", "CO2"), each = length(years_decay))
)
p_decay <- ggplot(decay_data, aes(x = year, y = fraction_remaining, color = gas_type)) +
geom_line(size = 1.5) +
scale_color_manual(values = c("Methane" = "red", "CO2" = "darkblue")) +
scale_y_continuous(labels = percent_format()) +
labs(title = "Atmospheric Decay: Methane vs CO2",
subtitle = "Methane decays rapidly (9.5-year lifetime) vs CO2 (centuries)",
x = "Years After Emission",
y = "Fraction Remaining in Atmosphere",
color = "Greenhouse Gas",
caption = "Methane provides intense near-term warming but disappears quickly") +
theme_minimal() +
theme(legend.position = "bottom")
print(p_decay)
cat("\n=== TIPPING POINTS IMPLICATIONS ===\n")
cat("Near-term methane reduction may be critical if climate tipping points are imminent:\n")
cat("- Methane: 84x CO2 warming over 20 years, then rapid decay\n")
cat("- CO2: Lower immediate impact but accumulates for centuries\n")
cat("- Heat pumps eliminate methane immediately (complete gas supply chain)\n")
cat("- Solar+battery reduces long-term CO2 but leaves methane unchanged\n")
cat("- Optimal strategy depends on tipping points timeline urgency\n")
#OBJECTIVE DATA PRESENTATION - NO PREDETERMINED CONCLUSIONS
cat("=== COMPLETE EMISSIONS ANALYSIS DATA SUMMARY ===\n")
cat("Objective findings for December 31, 2025 tax credit decision\n\n")
# Battery analysis result
cat("BATTERY LOAD SHIFTING ANALYSIS:\n")
cat("Peak emissions (4 PM with upstream):", round(battery_complete_value$peak_emissions_lbs_per_kwh, 3), "lbs CO2e/kWh\n")
# Clear environment and set up
rm(list=ls())
# Set working directory relative to .Rmd location FIRST
r_scriptwd <- getwd()
wd <- dirname(r_scriptwd)
knitr::opts_knit$set(root.dir = wd)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 12, fig.height = 8, dpi = 150, fig.align = "center")
# Package management
packages <- c("tidyverse", "lubridate", "plotly", "kableExtra", "scales", "viridis", "patchwork")
new.packages <- packages[!(packages %in% installed.packages()[, "Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(packages, library, character.only = TRUE)
# Load house profile from House Component - DO NOT HARDCODE
# Working directory now set correctly above
if(!file.exists("output/house_profile.RData")) {
stop("house_profile.RData not found. Run House Component analysis first.")
}
load("output/house_profile.RData")
# Validate house profile loaded correctly
if(!exists("house_profile")) {
stop("house_profile object not found in loaded data.")
}
cat("=== LOADING VALIDATED HOUSE DATA ===\n")
cat("House profile version:", house_profile$version, "\n")
cat("Analysis date:", house_profile$analysis_date, "\n")
cat("Validation status:", house_profile$gas_appliance_breakdown$validation_status, "\n")
# INTEGRATED emissions factors - TROPOMI methane + detailed dispatch
emissions_factors <- list(
# Natural gas - UPDATED to TROPOMI satellite data (4.5% leakage)
gas_scenarios = list(
# EPA bottom-up estimates (conservative, facility-reported)
epa_conservative = list(
name = "EPA GHGI",
ch4_leakage_rate = 0.023,    # 2.3% (EPA Greenhouse Gas Inventory 2024)
source = "EPA bottom-up facility reports",
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.023 * 84)  # ~18.33 lbs/therm
),
# Alvarez et al. 2018 Science - 60% higher than EPA
alvarez_science = list(
name = "Alvarez Science 2018",
ch4_leakage_rate = 0.037,    # 60% higher than EPA (~3.7%)
source = "Facility-scale synthesis, top-down measurements",
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.037 * 84)  # ~21.27 lbs/therm
),
# TROPOMI satellite inversions - NOW BASELINE (updated from older script)
tropomi_satellite = list(
name = "TROPOMI Satellite",
ch4_leakage_rate = 0.045,    # 4.5% (high-resolution satellite inversions)
source = "Nesser et al. 2024 ACP, TROPOMI inversions",
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.045 * 84)  # ~22.95 lbs/therm
),
# EDF aircraft campaigns - highest measured rates
edf_aircraft = list(
name = "EDF MethaneAIR",
ch4_leakage_rate = 0.092,    # ~4x EPA (9.2%) from aerial surveys
source = "EDF MethaneAIR aircraft campaigns, surveyed basins",
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.092 * 84)  # ~32.82 lbs/therm
)
),
# Use TROPOMI satellite data as baseline (UPDATED from 2.5% to 4.5%)
gas_baseline = list(
co2_per_therm = 11.7 + 1.8,  # Combustion + upstream
ch4_leakage_rate = 0.045,    # 4.5% TROPOMI satellite measurements (UPDATED)
ch4_lbs_per_therm = 2.5,
ch4_gwp_20yr = 84,           # IPCC AR6 - tipping points metric
ch4_gwp_100yr = 28,          # IPCC AR6 - traditional metric
ch4_lifetime_yr = 9.5,       # Atmospheric decay time
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.045 * 84)  # ~22.95 lbs/therm
)
)
# Calculate baseline emissions with sensitivity analysis
baseline_gas_therms <- house_profile$baseline_consumption$annual_therms_gas
baseline_electric_kwh <- house_profile$baseline_consumption$annual_kwh_electric
# Calculate emissions for each methane leakage scenario
methane_sensitivity <- map_dfr(emissions_factors$gas_scenarios, ~{
gas_emissions_tons <- baseline_gas_therms * .x$total_co2e_per_therm_20yr / 2000
electric_emissions_tons <- baseline_electric_kwh * 1.35 / 2000  # Will be replaced by dispatch model
total_emissions <- gas_emissions_tons + electric_emissions_tons
# Methane component
ch4_leaked_lbs <- baseline_gas_therms * .x$ch4_leakage_rate * 2.5
ch4_co2e_tons <- ch4_leaked_lbs * 84 / 2000
methane_share_percent <- (ch4_co2e_tons / gas_emissions_tons) * 100
data.frame(
scenario = .x$name,
leakage_rate_pct = .x$ch4_leakage_rate * 100,
source = .x$source,
gas_emissions_tons = round(gas_emissions_tons, 1),
electric_emissions_tons = round(electric_emissions_tons, 1),
total_emissions_tons = round(total_emissions, 1),
methane_share_pct = round(methane_share_percent, 0),
stringsAsFactors = FALSE
)
})
# Use TROPOMI satellite data as baseline for main analysis
baseline_gas_emissions_tons <- methane_sensitivity$gas_emissions_tons[methane_sensitivity$scenario == "TROPOMI Satellite"]
baseline_electric_emissions_tons <- methane_sensitivity$electric_emissions_tons[1]  # Will be updated by dispatch
total_baseline_emissions <- baseline_gas_emissions_tons + baseline_electric_emissions_tons
# Methane component using TROPOMI rates
ch4_leaked_lbs <- baseline_gas_therms * emissions_factors$gas_baseline$ch4_leakage_rate * emissions_factors$gas_baseline$ch4_lbs_per_therm
ch4_co2e_tons <- ch4_leaked_lbs * emissions_factors$gas_baseline$ch4_gwp_20yr / 2000
methane_share_percent <- (ch4_co2e_tons / baseline_gas_emissions_tons) * 100
methane_sensitivity %>%
kable(caption = "UPDATED: Methane Leakage Sensitivity Analysis (Now Using TROPOMI 4.5%)",
col.names = c("Study/Method", "Leakage Rate (%)", "Source",
"Gas Emissions (tons CO2e/yr)", "Electric Emissions (tons CO2e/yr)",
"Total Emissions (tons CO2e/yr)", "Methane Share (%)")) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE, font_size = 14) %>%
row_spec(3, bold = TRUE, background = "#e8f5e8") %>%  # Highlight TROPOMI baseline (NOW UPDATED)
row_spec(4, background = "#ffe6e6") %>%  # Highlight highest case
add_header_above(c(" " = 3, "Annual Emissions" = 3, " " = 1))
# Georgia Power merit order dispatch emissions - INTEGRATED from older script
calculate_hourly_emissions <- function(datetime, grid_year = 2025) {
hour <- hour(datetime)
month <- month(datetime)
wday <- wday(datetime)
# Base emissions by generation type (lbs CO2/kWh)
emissions_by_type <- list(
nuclear = 0,           # Zero emissions
coal = 2.23,          # Lignite/sub-bituminous
gas_cc = 0.91,        # Combined cycle
gas_ct = 1.22,        # Combustion turbine (peaker) - DIRTIEST
solar = 0,            # Zero operational
wind = 0              # Zero operational
)
# Hourly dispatch logic based on merit order and load
if(hour >= 0 & hour < 6) {
# Night: Baseload only (nuclear + coal) - CLEANEST HOURS
nuclear_share <- 0.35
coal_share <- 0.65
gas_cc_share <- 0
gas_ct_share <- 0  # No peakers
solar_share <- 0
} else if(hour >= 6 & hour < 10) {
# Morning ramp: Add combined cycle
nuclear_share <- 0.25
coal_share <- 0.45
gas_cc_share <- 0.30
gas_ct_share <- 0  # Still no peakers
solar_share <- 0
} else if(hour >= 10 & hour < 14) {
# Midday: Solar contribution (summer stronger)
nuclear_share <- 0.20
coal_share <- 0.35
if(month %in% 5:9) {
solar_share <- 0.15  # Utility solar peaks
gas_cc_share <- 0.30
} else {
solar_share <- 0.05
gas_cc_share <- 0.40
}
gas_ct_share <- 0  # Still no peakers
} else if(hour >= 14 & hour < 19) {
# Peak demand: ALL resources including peakers - DIRTIEST HOURS
nuclear_share <- 0.15
coal_share <- 0.30
gas_cc_share <- 0.30
gas_ct_share <- 0.20  # PEAKERS RUNNING - key for solar export value
solar_share <- ifelse(month %in% 5:9 & hour < 18, 0.05, 0)
} else {
# Evening ramp down: Some gas still running
nuclear_share <- 0.25
coal_share <- 0.40
gas_cc_share <- 0.35
gas_ct_share <- 0.05  # Some peakers still on
solar_share <- 0
}
# Calculate weighted emissions factor
emissions_factor <-
nuclear_share * emissions_by_type$nuclear +
coal_share * emissions_by_type$coal +
gas_cc_share * emissions_by_type$gas_cc +
gas_ct_share * emissions_by_type$gas_ct +
solar_share * emissions_by_type$solar
# Apply grid evolution scaling (gets cleaner over time)
grid_evolution_factor <- case_when(
grid_year <= 2025 ~ 1.0,
grid_year <= 2030 ~ 0.85,
grid_year <= 2035 ~ 0.65,
TRUE ~ 0.45
)
# Add 10% transmission losses
return(emissions_factor * grid_evolution_factor * 1.1)
}
# Create comprehensive daily emissions profiles
create_daily_emissions_profile <- function(season = "summer", year = 2025) {
hours <- 0:23
month <- ifelse(season == "summer", 7, 1)
emissions <- sapply(hours, function(h) {
datetime <- as.POSIXct(paste0(year, "-", sprintf("%02d", month), "-15 ",
sprintf("%02d", h), ":00:00"),
tz = "America/New_York")
calculate_hourly_emissions(datetime, year)
})
data.frame(
hour = hours,
emissions_factor = emissions,
season = season,
year = year,
period = case_when(
hours >= 0 & hours < 6 ~ "Night Baseload (Cleanest)",
hours >= 6 & hours < 14 ~ "Morning/Midday Ramp",
hours >= 14 & hours < 19 ~ "Peak + Peakers (Dirtiest)",
TRUE ~ "Evening Ramp Down"
)
)
}
# Generate profiles for analysis
summer_profile <- create_daily_emissions_profile("summer", 2025)
winter_profile <- create_daily_emissions_profile("winter", 2025)
# DISPATCH VISUALIZATION - Individual plot optimized for iPad
p_dispatch <- ggplot() +
geom_line(data = summer_profile,
aes(x = hour, y = emissions_factor, color = "Summer"),
size = 1.5) +
geom_line(data = winter_profile,
aes(x = hour, y = emissions_factor, color = "Winter"),
size = 1.5) +
# Highlight key periods
annotate("rect", xmin = 14, xmax = 19, ymin = 0, ymax = Inf,
alpha = 0.2, fill = "red") +
annotate("rect", xmin = 0, xmax = 6, ymin = 0, ymax = Inf,
alpha = 0.1, fill = "blue") +
# Labels for key insights
annotate("text", x = 16.5, y = 0.4,
label = "PEAK HOURS\nGas Peakers\n(Dirtiest)",
size = 4, fontface = "bold", color = "darkred") +
annotate("text", x = 3, y = 0.4,
label = "NIGHT BASELOAD\nNuclear/Coal\n(Cleanest)",
size = 4, fontface = "bold", color = "darkblue") +
geom_hline(yintercept = mean(summer_profile$emissions_factor),
linetype = "dashed", alpha = 0.7, color = "gray") +
annotate("text", x = 20, y = mean(summer_profile$emissions_factor) + 0.05,
label = "Daily Average", size = 3) +
scale_x_continuous(breaks = seq(0, 23, 3)) +
scale_color_manual(values = c("Summer" = "red", "Winter" = "blue")) +
labs(title = "Georgia Power Hourly Emissions: Merit Order Dispatch Analysis",
subtitle = "Gas peakers (2-7 PM) create 35% higher emissions than night baseload",
x = "Hour of Day",
y = "Emissions Factor (lbs CO2/kWh)",
color = "Season",
caption = "Red = Peak hours when solar exports, Blue = Night hours when grid imports occur") +
theme_minimal() +
theme(legend.position = "bottom",
plot.title = element_text(size = 16, face = "bold"),
plot.subtitle = element_text(size = 14))
print(p_dispatch)
# Calculate key dispatch metrics for later use
peak_emissions_factor <- mean(filter(summer_profile, hour >= 14, hour < 19)$emissions_factor)
baseload_emissions_factor <- mean(filter(summer_profile, hour >= 0, hour < 6)$emissions_factor)
evening_emissions_factor <- mean(filter(summer_profile, hour >= 19, hour < 23)$emissions_factor)
cat("KEY DISPATCH METRICS:\n")
cat("Peak hours (2-7 PM):", round(peak_emissions_factor, 3), "lbs CO2e/kWh\n")
cat("Baseload (midnight-6 AM):", round(baseload_emissions_factor, 3), "lbs CO2e/kWh\n")
cat("Evening (7-11 PM):", round(evening_emissions_factor, 3), "lbs CO2e/kWh\n")
cat("Temporal arbitrage opportunity:", round((peak_emissions_factor/baseload_emissions_factor - 1) * 100, 0), "% higher emissions during peaks\n")
# Clear environment and set up
rm(list=ls())
# Set working directory relative to .Rmd location FIRST
r_scriptwd <- getwd()
wd <- dirname(r_scriptwd)
knitr::opts_knit$set(root.dir = wd)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 12, fig.height = 8, dpi = 150, fig.align = "center")
# Package management
packages <- c("tidyverse", "lubridate", "plotly", "kableExtra", "scales", "viridis", "patchwork")
new.packages <- packages[!(packages %in% installed.packages()[, "Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(packages, library, character.only = TRUE)
# Load house profile from House Component - DO NOT HARDCODE
# Working directory now set correctly above
# if(!file.exists("output/house_profile.RData")) {
#   stop("house_profile.RData not found. Run House Component analysis first.")
}
# Clear environment and set up
rm(list=ls())
# Set working directory relative to .Rmd location FIRST
r_scriptwd <- getwd()
wd <- dirname(r_scriptwd)
knitr::opts_knit$set(root.dir = wd)
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 12, fig.height = 8, dpi = 150, fig.align = "center")
# Package management
packages <- c("tidyverse", "lubridate", "plotly", "kableExtra", "scales", "viridis", "patchwork")
new.packages <- packages[!(packages %in% installed.packages()[, "Package"])]
if(length(new.packages)) install.packages(new.packages)
lapply(packages, library, character.only = TRUE)
# Load house profile from House Component - DO NOT HARDCODE
# Working directory now set correctly above
# if(!file.exists("output/house_profile.RData")) {
#   stop("house_profile.RData not found. Run House Component analysis first.")
# }
load("output/house_profile.RData")
# Validate house profile loaded correctly
# if(!exists("house_profile")) {
#   stop("house_profile object not found in loaded data.")
# }
cat("=== LOADING VALIDATED HOUSE DATA ===\n")
cat("House profile version:", house_profile$version, "\n")
cat("Analysis date:", house_profile$analysis_date, "\n")
cat("Validation status:", house_profile$gas_appliance_breakdown$validation_status, "\n")
# INTEGRATED emissions factors - TROPOMI methane + detailed dispatch
emissions_factors <- list(
# Natural gas - UPDATED to TROPOMI satellite data (4.5% leakage)
gas_scenarios = list(
# EPA bottom-up estimates (conservative, facility-reported)
epa_conservative = list(
name = "EPA GHGI",
ch4_leakage_rate = 0.023,    # 2.3% (EPA Greenhouse Gas Inventory 2024)
source = "EPA bottom-up facility reports",
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.023 * 84)  # ~18.33 lbs/therm
),
# Alvarez et al. 2018 Science - 60% higher than EPA
alvarez_science = list(
name = "Alvarez Science 2018",
ch4_leakage_rate = 0.037,    # 60% higher than EPA (~3.7%)
source = "Facility-scale synthesis, top-down measurements",
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.037 * 84)  # ~21.27 lbs/therm
),
# TROPOMI satellite inversions - NOW BASELINE (updated from older script)
tropomi_satellite = list(
name = "TROPOMI Satellite",
ch4_leakage_rate = 0.045,    # 4.5% (high-resolution satellite inversions)
source = "Nesser et al. 2024 ACP, TROPOMI inversions",
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.045 * 84)  # ~22.95 lbs/therm
),
# EDF aircraft campaigns - highest measured rates
edf_aircraft = list(
name = "EDF MethaneAIR",
ch4_leakage_rate = 0.092,    # ~4x EPA (9.2%) from aerial surveys
source = "EDF MethaneAIR aircraft campaigns, surveyed basins",
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.092 * 84)  # ~32.82 lbs/therm
)
),
# Use TROPOMI satellite data as baseline (UPDATED from 2.5% to 4.5%)
gas_baseline = list(
co2_per_therm = 11.7 + 1.8,  # Combustion + upstream
ch4_leakage_rate = 0.045,    # 4.5% TROPOMI satellite measurements (UPDATED)
ch4_lbs_per_therm = 2.5,
ch4_gwp_20yr = 84,           # IPCC AR6 - tipping points metric
ch4_gwp_100yr = 28,          # IPCC AR6 - traditional metric
ch4_lifetime_yr = 9.5,       # Atmospheric decay time
total_co2e_per_therm_20yr = 13.5 + (2.5 * 0.045 * 84)  # ~22.95 lbs/therm
)
)
# Calculate baseline emissions with sensitivity analysis
baseline_gas_therms <- house_profile$baseline_consumption$annual_therms_gas
baseline_electric_kwh <- house_profile$baseline_consumption$annual_kwh_electric
# Calculate emissions for each methane leakage scenario
methane_sensitivity <- map_dfr(emissions_factors$gas_scenarios, ~{
gas_emissions_tons <- baseline_gas_therms * .x$total_co2e_per_therm_20yr / 2000
electric_emissions_tons <- baseline_electric_kwh * 1.35 / 2000  # Will be replaced by dispatch model
total_emissions <- gas_emissions_tons + electric_emissions_tons
# Methane component
ch4_leaked_lbs <- baseline_gas_therms * .x$ch4_leakage_rate * 2.5
ch4_co2e_tons <- ch4_leaked_lbs * 84 / 2000
methane_share_percent <- (ch4_co2e_tons / gas_emissions_tons) * 100
data.frame(
scenario = .x$name,
leakage_rate_pct = .x$ch4_leakage_rate * 100,
source = .x$source,
gas_emissions_tons = round(gas_emissions_tons, 1),
electric_emissions_tons = round(electric_emissions_tons, 1),
total_emissions_tons = round(total_emissions, 1),
methane_share_pct = round(methane_share_percent, 0),
stringsAsFactors = FALSE
)
})
# Use TROPOMI satellite data as baseline for main analysis
baseline_gas_emissions_tons <- methane_sensitivity$gas_emissions_tons[methane_sensitivity$scenario == "TROPOMI Satellite"]
baseline_electric_emissions_tons <- methane_sensitivity$electric_emissions_tons[1]  # Will be updated by dispatch
total_baseline_emissions <- baseline_gas_emissions_tons + baseline_electric_emissions_tons
# Methane component using TROPOMI rates
ch4_leaked_lbs <- baseline_gas_therms * emissions_factors$gas_baseline$ch4_leakage_rate * emissions_factors$gas_baseline$ch4_lbs_per_therm
ch4_co2e_tons <- ch4_leaked_lbs * emissions_factors$gas_baseline$ch4_gwp_20yr / 2000
methane_share_percent <- (ch4_co2e_tons / baseline_gas_emissions_tons) * 100
